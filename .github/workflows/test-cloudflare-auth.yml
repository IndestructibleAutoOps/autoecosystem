name: Test Cloudflare Auth

on:
  workflow_dispatch: # 允許手動觸發

jobs:
  test-auth:
    runs-on: ubuntu-latest
    steps:
      - name: Test Cloudflare API Token
        run: |
          RESPONSE=$(curl -s -X GET "https://api.cloudflare.com/client/v4/user/tokens/verify"             -H "Authorization: Bearer ${{ secrets.CLOUDFLARE_API_TOKEN }}"             -H "Content-Type: application/json")
          
          STATUS=$(echo $RESPONSE | jq -r '.result.status')
          if [ "$STATUS" == "active" ]; then
            echo "✅ Cloudflare API Token is VALID and ACTIVE."
          else
            echo "❌ Cloudflare API Token is INVALID or INACTIVE."
            echo "Response: $RESPONSE"
            exit 1
          fi

      - name: Test Cloudflare Account Access
        run: |
          RESPONSE=$(curl -s -X GET "https://api.cloudflare.com/client/v4/accounts/${{ secrets.CLOUDFLARE_ACCOUNT_ID }}/pages/projects"             -H "Authorization: Bearer ${{ secrets.CLOUDFLARE_API_TOKEN }}"             -H "Content-Type: application/json")
          
          SUCCESS=$(echo $RESPONSE | jq -r '.success')
          if [ "$SUCCESS" == "true" ]; then
            echo "✅ Successfully accessed Cloudflare Pages projects."
          else
            echo "❌ Failed to access Cloudflare Pages projects."
            echo "Response: $RESPONSE"
            exit 1
          fi
